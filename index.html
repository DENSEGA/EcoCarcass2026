<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>EcoCarcass2026 ‚Äî –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ–º–∞ | –≠–∫–æ –ö–∞—Ä–∫–∞—Å</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --card:#fff;--accent:#7ed957;--accent2:#39b54a;
      --soft:#e9fbe1;--text:#0f172a;--muted:#64748b;
      --border:#e6ebef;--shadow:0 18px 48px rgba(2,6,23,.08);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:Manrope,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
    body{
      background:
        radial-gradient(1200px 500px at 20% -10%, #eaffea 0%, rgba(234,255,234,0) 60%),
        radial-gradient(900px 400px at 90% 10%, #e8fff1 0%, rgba(232,255,241,0) 55%),
        linear-gradient(180deg, #f7fff8 0%, #f3fbf3 70%, #f4f8ff 100%);
      color:var(--text);padding:20px;
    }
    .app{max-width:1200px;margin:0 auto;}
    .top{display:flex;align-items:center;justify-content:space-between;gap:14px;margin-bottom:18px;flex-wrap:wrap;}
    .brand{display:flex;align-items:center;gap:12px;}
    .mark{
      width:46px;height:46px;border-radius:16px;
      background:radial-gradient(circle at 30% 20%, #fff 0, #c9f7b6 35%, #2ea043 100%);
      box-shadow:0 12px 28px rgba(46,160,67,.28);
      display:flex;align-items:center;justify-content:center;
      font-weight:900;letter-spacing:.04em;color:#0b1220;font-size:18px;
    }
    h1{font-size:22px;letter-spacing:.02em;text-transform:uppercase;font-weight:900;}
    .sub{font-size:13px;color:var(--muted);margin-top:2px;line-height:1.35;}
    .tag{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:rgba(126,217,87,.14);border:1px solid rgba(126,217,87,.5);color:#166534;font-weight:900;font-size:12px;white-space:nowrap;}
    .dot{width:8px;height:8px;border-radius:999px;background:#22c55e;box-shadow:0 0 0 5px rgba(34,197,94,.22);}
    .grid{display:grid;grid-template-columns:minmax(0,1.55fr) minmax(0,1fr);gap:18px;}
    @media(max-width:980px){.grid{grid-template-columns:1fr;}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:18px;}
    .head{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;margin-bottom:12px;}
    .title{font-size:18px;font-weight:900;}
    .desc{font-size:13px;color:var(--muted);margin-top:4px;line-height:1.35;}

    .progress{display:flex;align-items:center;gap:10px;margin-top:10px;}
    .bar{flex:1;height:8px;background:#eaf6ea;border-radius:999px;overflow:hidden;}
    .fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#b7f26f,var(--accent2));border-radius:999px;transition:.2s;}
    .ptext{font-size:12px;color:var(--muted);white-space:nowrap;}

    .step{display:none;}
    .step.active{display:block;}
    .kicker{font-size:12px;color:var(--muted);letter-spacing:.12em;text-transform:uppercase;margin-bottom:6px;}
    .stitle{font-size:16px;font-weight:900;margin-bottom:10px;}

    .options{display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:10px;}
    .opt{border:1px solid var(--border);border-radius:16px;background:#f9fbff;padding:12px;cursor:pointer;position:relative;transition:.15s;min-height:78px;}
    .opt:hover{border-color:rgba(57,181,74,.55);box-shadow:0 10px 24px rgba(34,197,94,.18);transform:translateY(-1px);}
    .opt.active{background:var(--soft);border-color:rgba(22,101,52,.55);box-shadow:0 12px 26px rgba(34,197,94,.24);}
    .opt .t{font-weight:900;font-size:14px;margin-bottom:4px;}
    .opt .s{font-size:12px;color:var(--muted);line-height:1.25;}
    .chip{position:absolute;top:10px;right:10px;font-size:11px;font-weight:900;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.9);border:1px solid rgba(148,163,184,.55);color:#475569;}
    .chip.green{border-color:rgba(34,197,94,.6);color:#166534;background:#effef4;}
    .chip.premium{border-color:rgba(251,191,36,.65);color:#92400e;background:#fffbeb;}

    .field{margin-top:12px;}
    label{display:block;font-size:13px;font-weight:900;color:#334155;margin-bottom:6px;}
    input[type="number"], select{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);
      background:#f8fafc;font-size:14px;outline:none;
    }
    input[type="number"]:focus, select:focus{border-color:rgba(57,181,74,.55);box-shadow:0 0 0 3px rgba(126,217,87,.18);background:#fff;}
    .hint{font-size:12px;color:var(--muted);margin-top:6px;line-height:1.3;}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    @media(max-width:560px){.row2{grid-template-columns:1fr;}}

    .checks{display:grid;grid-template-columns:1fr;gap:8px;margin-top:8px;}
    .check{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:#fbfdff;}
    .check input{margin-top:3px;accent-color:var(--accent2);}
    .check .ct{font-weight:900;font-size:13px;}
    .check .cs{font-size:12px;color:var(--muted);margin-top:2px;line-height:1.2;}

    .nav{display:flex;justify-content:space-between;gap:10px;margin-top:14px;flex-wrap:wrap;}
    .btn{border:none;border-radius:999px;padding:10px 16px;font-weight:900;font-size:13px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;}
    .ghost{background:transparent;border:1px dashed var(--border);color:var(--muted);}
    .ghost:hover{border-style:solid;color:#0f172a;}
    .primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;box-shadow:0 12px 28px rgba(34,197,94,.25);}
    .primary:disabled{opacity:.5;cursor:default;box-shadow:none;}
    .mini{padding:8px 12px;font-size:12px;font-weight:900;}

    .danger{color:#b91c1c;font-size:12px;font-weight:900;margin-top:6px;display:none;}

    .rhead{display:flex;justify-content:space-between;align-items:flex-start;gap:10px;margin-bottom:8px;}
    .rbrand{font-weight:900;letter-spacing:.08em;text-transform:uppercase;font-size:14px;}
    .total{font-size:28px;font-weight:900;margin:10px 0 2px;}
    .perm2{font-size:13px;color:var(--muted);}

    .line{display:flex;justify-content:space-between;font-size:13px;margin-top:6px;}
    .line b{font-weight:900;}
    .sep{border-top:1px dashed var(--border);margin:12px 0;}
    .footer-note{font-size:12px;color:var(--muted);line-height:1.35;}

    .badge{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:14px;border:1px solid rgba(34,197,94,.35);background:#dcfce7;color:#166534;font-weight:900;font-size:12px;}
    .pills{display:flex;flex-wrap:wrap;gap:6px;}
    .pill{font-size:11px;font-weight:900;padding:6px 10px;border-radius:999px;background:#f1f5f9;color:#334155;}
    .pill.green{background:#dcfce7;color:#166534;border:1px solid rgba(34,197,94,.35);}
  </style>
</head>

<body>
<div class="app">
  <div class="top">
    <div class="brand">
      <div class="mark">–≠–ö</div>
      <div>
        <h1>–≠–∫–æ –ö–∞—Ä–∫–∞—Å</h1>
        <div class="sub" id="foundationHeader">–§—É–Ω–¥–∞–º–µ–Ω—Ç: (—É—Ç–æ—á–Ω—è–µ—Ç—Å—è –≤—ã–±–æ—Ä–æ–º) ¬∑ –î–ª—è –∫–∞–º–µ–Ω–Ω—ã—Ö –¥–æ–º–æ–≤ ‚Äî –ø–ª–∏—Ç–∞ 250 –º–º –≤ –±–∞–∑–µ</div>
      </div>
    </div>
    <div class="tag"><span class="dot"></span> EcoCarcass2026 ¬∑ –û–Ω–ª–∞–π–Ω-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</div>
  </div>

  <div class="grid">
    <!-- LEFT -->
    <div class="card">
      <div class="head">
        <div>
          <div class="title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–º–∞</div>
          <div class="desc">–¶–µ–Ω—ã —Å–∫—Ä—ã—Ç—ã. –í—ã –≤–∏–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –∏—Ç–æ–≥ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º. –í –∫–æ–Ω—Ü–µ ‚Äî —Ä–∞—Å—á—ë—Ç –¥–ª—è –ø–µ—á–∞—Ç–∏ + –ø–æ–¥–∞—Ä–æ–∫: —Å–∫–∏–¥–∫–∞ 2% ‚Äú–æ—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è‚Äù.</div>
        </div>
      </div>

      <div class="progress">
        <div class="bar"><div class="fill" id="fill"></div></div>
        <div class="ptext" id="ptext">–®–∞–≥ 1 –∏–∑ 5</div>
      </div>

      <!-- STEP 1 -->
      <div class="step active" data-step="1">
        <div class="kicker">–®–∞–≥ 1</div>
        <div class="stitle">–¢–∏–ø –¥–æ–º–∞ –∏ —ç—Ç–∞–∂–Ω–æ—Å—Ç—å</div>

        <label>–¢–∏–ø –¥–æ–º–∞</label>
        <div class="options" data-group="houseType">
          <div class="opt active" data-value="frame">
            <div class="t">–ö–∞—Ä–∫–∞—Å–Ω—ã–π</div><div class="s">–ë—ã—Å—Ç—Ä–æ, —Ç–µ–ø–ª–æ, –ª—ë–≥–∫–∏–π –¥–æ–º.</div><div class="chip green">–≠–∫–æ</div>
          </div>
          <div class="opt" data-value="gasblock">
            <div class="t">–ì–∞–∑–æ–±–ª–æ–∫ 400 –º–º</div><div class="s">–ö–∞–º–µ–Ω–Ω—ã–π –¥–æ–º.</div><div class="chip">–ö–∞–º–µ–Ω—å</div>
          </div>
          <div class="opt" data-value="porotherm">
            <div class="t">Porotherm / –∫–∏—Ä–ø–∏—á 440 –º–º</div><div class="s">–ö–∞–º–µ–Ω–Ω—ã–π –¥–æ–º –ø—Ä–µ–º–∏—É–º.</div><div class="chip premium">–ü—Ä–µ–º–∏—É–º</div>
          </div>
        </div>

        <div class="field">
          <label>–≠—Ç–∞–∂–Ω–æ—Å—Ç—å</label>
          <div class="options" data-group="floors">
            <div class="opt active" data-value="1"><div class="t">1 —ç—Ç–∞–∂</div><div class="s">–ö–æ–º—Ñ–æ—Ä—Ç –±–µ–∑ –ª–µ—Å—Ç–Ω–∏—Ü—ã.</div><div class="chip green">–ü–æ–ø—É–ª—è—Ä–Ω–æ</div></div>
            <div class="opt" data-value="2"><div class="t">2 —ç—Ç–∞–∂–∞</div><div class="s">–ë–æ–ª—å—à–µ –ø–ª–æ—â–∞–¥–∏ –Ω–∞ —É—á–∞—Å—Ç–∫–µ.</div><div class="chip">–ö–æ–º–ø–∞–∫—Ç–Ω–æ</div></div>
          </div>
          <div class="hint">–≠—Ç–∞–∂–Ω–æ—Å—Ç—å –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Ü–µ–Ω–∫—É –ø–ª–æ—â–∞–¥–∏ –∫—Ä–æ–≤–ª–∏ (–ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ).</div>
        </div>
      </div>

      <!-- STEP 2 -->
      <div class="step" data-step="2">
        <div class="kicker">–®–∞–≥ 2</div>
        <div class="stitle">–£—Ç–µ–ø–ª–µ–Ω–∏–µ, –ø–ª–æ—â–∞–¥–∏, —Ç–µ—Ä—Ä–∞—Å—ã, —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç</div>

        <div id="insulationWrap">
          <label>–£—Ç–µ–ø–ª–µ–Ω–∏–µ —Å—Ç–µ–Ω (—Ç–æ–ª—å–∫–æ –∫–∞—Ä–∫–∞—Å)</label>
          <div class="options" data-group="insulation">
            <div class="opt" data-value="150"><div class="t">150 –º–º</div><div class="s">–≠–∫–æ–Ω–æ–º–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.</div><div class="chip">–≠–∫–æ–Ω–æ–º</div></div>
            <div class="opt active" data-value="200"><div class="t">200 –º–º</div><div class="s">–ö—Ä—É–≥–ª–æ–≥–æ–¥–∏—á–Ω–æ.</div><div class="chip green">–¢—ë–ø–ª—ã–π</div></div>
          </div>
        </div>

        <div class="field row2">
          <div>
            <label for="area">–ñ–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å –¥–æ–º–∞, –º¬≤</label>
            <input id="area" type="number" min="40" max="500" value="100">
            <div class="hint">–ë–µ–∑ —Ç–µ—Ä—Ä–∞—Å.</div>
            <div class="danger" id="areaErr">–í–≤–µ–¥–∏—Ç–µ –ø–ª–æ—â–∞–¥—å –æ—Ç 40 –¥–æ 500 –º¬≤.</div>
          </div>
          <div>
            <label for="terraceClosed">–¢–µ—Ä—Ä–∞—Å–∞ –∑–∞–∫—Ä—ã—Ç–∞—è, –º¬≤</label>
            <input id="terraceClosed" type="number" min="0" max="300" value="0">
            <div class="hint">–£—á–∏—Ç—ã–≤–∞–µ–º –ø–æ –ø–ª–æ—â–∞–¥–∏ —Ç–µ—Ä—Ä–∞—Å—ã.</div>
          </div>
        </div>

        <div class="field row2">
          <div>
            <label for="terraceOpen">–¢–µ—Ä—Ä–∞—Å–∞ –æ—Ç–∫—Ä—ã—Ç–∞—è, –º¬≤</label>
            <input id="terraceOpen" type="number" min="0" max="300" value="0">
            <div class="hint">–£—á–∏—Ç—ã–≤–∞–µ–º –ø–æ –ø–ª–æ—â–∞–¥–∏ —Ç–µ—Ä—Ä–∞—Å—ã.</div>
          </div>
          <div>
            <label for="terraceCover">–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Ä—Ä–∞—Å—ã</label>
            <select id="terraceCover">
              <option value="dpk" selected>–î–ü–ö</option>
              <option value="larch">–õ–∏—Å—Ç–≤–µ–Ω–Ω–∏—Ü–∞</option>
            </select>
            <div class="hint">–ü–æ–∫—Ä—ã—Ç–∏–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é, —Ü–µ–Ω—É –¥–µ—Ä–∂–∏–º –≤ –±–∞–∑–µ —Ç–µ—Ä—Ä–∞—Å—ã.</div>
          </div>
        </div>

        <div class="field">
          <label>–§—É–Ω–¥–∞–º–µ–Ω—Ç</label>
          <div id="foundationFrameWrap">
            <div class="options" data-group="foundation">
              <div class="opt active" data-value="screw"><div class="t">–í–∏–Ω—Ç–æ–≤—ã–µ —Å–≤–∞–∏ 108√ó2500</div><div class="s">–í –±–∞–∑–µ –¥–ª—è –∫–∞—Ä–∫–∞—Å–Ω–æ–≥–æ –¥–æ–º–∞.</div><div class="chip green">–ë–∞–∑–∞</div></div>
              <div class="opt" data-value="rcpiles"><div class="t">–ñ–ë–ò —Å–≤–∞–∏ 150√ó150√ó3000</div><div class="s">–ñ—ë—Å—Ç–∫–æ –∏ –Ω–∞–¥—ë–∂–Ω–æ.</div><div class="chip">–û–ø—Ü–∏—è</div></div>
              <div class="opt" data-value="slab300"><div class="t">–ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –ø–ª–∏—Ç–∞ 300 –º–º</div><div class="s">–ö–∞–∫ –æ–ø—Ü–∏—è –¥–ª—è –∫–∞—Ä–∫–∞—Å–Ω–æ–≥–æ.</div><div class="chip">–û–ø—Ü–∏—è</div></div>
            </div>
            <div class="hint">–î–ª—è –∫–∞—Ä–∫–∞—Å–Ω–æ–≥–æ: —Å–≤–∞–∏ –≤ –±–∞–∑–µ, –ñ–ë–ò/–ø–ª–∏—Ç–∞ ‚Äî –¥–æ–ø. –æ–ø—Ü–∏–∏.</div>
          </div>
          <div id="foundationStoneHint" class="hint" style="display:none;">
            –î–ª—è –∫–∞–º–µ–Ω–Ω—ã—Ö –¥–æ–º–æ–≤: –º–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –ø–ª–∏—Ç–∞ 250 –º–º (–≤ –±–∞–∑–µ, –±–µ–∑ –¥–æ–ø–ª–∞—Ç).
          </div>
        </div>
      </div>

      <!-- STEP 3 -->
      <div class="step" data-step="3">
        <div class="kicker">–®–∞–≥ 3</div>
        <div class="stitle">–§–∞—Å–∞–¥, –æ–∫–Ω–∞, –∫—Ä–æ–≤–ª—è</div>

        <label>–§–∞—Å–∞–¥</label>
        <div class="options" data-group="exterior">
          <div class="opt active" data-value="wood"><div class="t">–î–µ—Ä–µ–≤–æ</div><div class="s">–ò–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞ –±–µ–∑ –æ–∫—Ä–∞—Å–∞.</div><div class="chip green">–ë–∞–∑–∞</div></div>
          <div class="opt" data-value="planken"><div class="t">–ü–ª–∞–Ω–∫–µ–Ω</div><div class="s">–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è –¥–æ—Å–∫–∞ –±–µ–∑ —à–∏–ø-–ø–∞–∑–∞.</div><div class="chip">–û–ø—Ü–∏—è</div></div>
          <div class="opt" data-value="metal"><div class="t">–ú–µ—Ç–∞–ª–ª–æ—Å–∞–π–¥–∏–Ω–≥</div><div class="s">–°—Ç–∞–ª—å —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º, –º–∏–Ω–∏–º—É–º —É—Ö–æ–¥–∞.</div><div class="chip">–û–ø—Ü–∏—è</div></div>
          <div class="opt" data-value="hauberk"><div class="t">Hauberk</div><div class="s">–ì–∏–±–∫–∞—è —Ñ–∞—Å–∞–¥–Ω–∞—è –ø–ª–∏—Ç–∫–∞ –ø–æ–¥ –∫–∏—Ä–ø–∏—á/–∫–∞–º–µ–Ω—å.</div><div class="chip">–û–ø—Ü–∏—è</div></div>
        </div>

        <div class="checks">
          <div class="check" id="paintWrap">
            <input id="paintWood" type="checkbox">
            <div>
              <div class="ct">–û–∫—Ä–∞—Å–∫–∞ —Ñ–∞—Å–∞–¥–∞ (–¥–µ—Ä–µ–≤–æ)</div>
              <div class="cs">–ü–æ–∫—Ä–∞—Å–∫–∞/–∑–∞—â–∏—Ç–∞ –ø–æ –ø–ª–æ—â–∞–¥–∏ –¥–æ–º–∞</div>
            </div>
          </div>

          <div class="check" id="faceBrickWrap" style="display:none;">
            <input id="faceBrick" type="checkbox">
            <div>
              <div class="ct">–§–∞—Å–∞–¥: –æ–±–ª–∏—Ü–æ–≤–æ—á–Ω—ã–π –∫–∏—Ä–ø–∏—á (—Ç–æ–ª—å–∫–æ –∫–∞–º–µ–Ω–Ω—ã–µ)</div>
              <div class="cs">–û–±–ª–∏—Ü–æ–≤–∫–∞ —Ñ–∞—Å–∞–¥–∞ –∫–∏—Ä–ø–∏—á–æ–º</div>
            </div>
          </div>
        </div>

        <div class="field">
          <label>–û–∫–Ω–∞</label>
          <div class="options" data-group="windows">
            <div class="opt active" data-value="white"><div class="t">–ë–µ–ª—ã–µ</div><div class="s">–°—Ç–∞–Ω–¥–∞—Ä—Ç.</div><div class="chip green">–ë–∞–∑–∞</div></div>
            <div class="opt" data-value="laminated"><div class="t">–õ–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</div><div class="s">–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ –ø–ª–æ—â–∞–¥–∏ –¥–æ–º–∞.</div><div class="chip">–û–ø—Ü–∏—è</div></div>
          </div>

          <div class="checks">
            <div class="check"><input id="portal" type="checkbox"><div><div class="ct">–†–∞–∑–¥–≤–∏–∂–Ω–æ–π –ø–æ—Ä—Ç–∞–ª</div><div class="cs">–û–ø—Ü–∏—è –∫–æ–º—Ñ–æ—Ä—Ç–∞</div></div></div>
            <div class="check"><input id="mosquito" type="checkbox"><div><div class="ct">–ú–æ—Å–∫–∏—Ç–Ω—ã–µ —Å–µ—Ç–∫–∏</div><div class="cs">–û–ø—Ü–∏—è –∫–æ–º—Ñ–æ—Ä—Ç–∞</div></div></div>
            <div class="check"><input id="energyGlass" type="checkbox"><div><div class="ct">–≠–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–≥–∞—é—â–∏–µ —Å—Ç–µ–∫–ª–∞</div><div class="cs">–û–ø—Ü–∏—è —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div></div></div>
          </div>
        </div>

        <div class="field">
          <label>–ö—Ä–æ–≤–ª—è</label>
          <div class="options" data-group="roof">
            <div class="opt active" data-value="metal_tile"><div class="t">–ú–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞</div><div class="s">–ö–ª–∞—Å—Å–∏–∫–∞, —Ä–µ–º–æ–Ω—Ç–æ–ø—Ä–∏–≥–æ–¥–Ω–∞—è.</div><div class="chip green">–¢–æ–ø</div></div>
            <div class="opt" data-value="prof"><div class="t">–ü—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª</div><div class="s">–ü—Ä–∞–∫—Ç–∏—á–Ω–æ –∏ –±—é–¥–∂–µ—Ç–Ω–æ.</div><div class="chip">–≠–∫–æ–Ω–æ–º</div></div>
            <div class="opt" data-value="click"><div class="t">–ö–ª–∏–∫-—Ñ–∞–ª—å—Ü</div><div class="s">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–∏–¥.</div><div class="chip">–û–ø—Ü–∏—è</div></div>
            <div class="opt" data-value="soft"><div class="t">–ú—è–≥–∫–∞—è</div><div class="s">–¢–∏—à–µ –ø–æ–¥ –¥–æ–∂–¥—ë–º.</div><div class="chip">–û–ø—Ü–∏—è</div></div>
          </div>

          <div class="checks">
            <div class="check"><input id="drainMetal" type="checkbox"><div><div class="ct">–í–æ–¥–æ—Å—Ç–æ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Grand Line (–º–µ—Ç–∞–ª–ª)</div><div class="cs">–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –∏—Ç–æ–≥–∞—Ö –ø–æ –ø–ª–æ—â–∞–¥–∏ –∫—Ä–æ–≤–ª–∏</div></div></div>
            <div class="check"><input id="drainPlastic" type="checkbox"><div><div class="ct">–í–æ–¥–æ—Å—Ç–æ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (–ø–ª–∞—Å—Ç–∏–∫)</div><div class="cs">–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –∏—Ç–æ–≥–∞—Ö –ø–æ –ø–ª–æ—â–∞–¥–∏ –∫—Ä–æ–≤–ª–∏</div></div></div>
            <div class="check"><input id="snow" type="checkbox"><div><div class="ct">–°–Ω–µ–≥–æ–∑–∞–¥–µ—Ä–∂–∞—Ç–µ–ª–∏ Grand Line</div><div class="cs">–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –∏—Ç–æ–≥–∞—Ö –ø–æ –ø–ª–æ—â–∞–¥–∏ –∫—Ä–æ–≤–ª–∏</div></div></div>
            <div class="check"><input id="soffitMetal" type="checkbox"><div><div class="ct">–ü–æ–¥—à–∏–≤ —Å–≤–µ—Å–æ–≤: –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π —Å–æ—Ñ–∏—Ç</div><div class="cs">–ü–ª–∞—Å—Ç–∏–∫–æ–≤—ã–µ —Å–æ—Ñ–∏—Ç—ã ‚Äî –≤ –±–∞–∑–µ</div></div></div>
          </div>
          <div class="hint">–ü–ª–æ—â–∞–¥—å –∫—Ä–æ–≤–ª–∏ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ: (–ø–ª–æ—â–∞–¥—å –¥–æ–º–∞ / —ç—Ç–∞–∂–Ω–æ—Å—Ç—å) √ó –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç.</div>
        </div>
      </div>

      <!-- STEP 4 -->
      <div class="step" data-step="4">
        <div class="kicker">–®–∞–≥ 4</div>
        <div class="stitle">–ò–Ω–∂–µ–Ω–µ—Ä–∏—è</div>
        <div class="hint">–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã. –°—Ç–æ–∏–º–æ—Å—Ç—å —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>

        <div class="checks">
          <div class="check"><input id="engHeat" type="checkbox"><div><div class="ct">–û—Ç–æ–ø–ª–µ–Ω–∏–µ</div><div class="cs">–°—á–∏—Ç–∞–µ–º –ø–æ –ø–ª–æ—â–∞–¥–∏ –¥–æ–º–∞</div></div></div>
          <div class="check"><input id="engWater" type="checkbox"><div><div class="ct">–í–æ–¥–∞ / –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è</div><div class="cs">–°—á–∏—Ç–∞–µ–º –ø–æ –ø–ª–æ—â–∞–¥–∏ –¥–æ–º–∞</div></div></div>
          <div class="check"><input id="engElectric" type="checkbox"><div><div class="ct">–≠–ª–µ–∫—Ç—Ä–∏–∫–∞ (—á–µ—Ä–Ω–æ–≤–∞—è)</div><div class="cs">–°—á–∏—Ç–∞–µ–º –ø–æ –ø–ª–æ—â–∞–¥–∏ –¥–æ–º–∞</div></div></div>
          <div class="check"><input id="engVent" type="checkbox"><div><div class="ct">–í–µ–Ω—Ç–∏–ª—è—Ü–∏—è</div><div class="cs">–°—á–∏—Ç–∞–µ–º –ø–æ –ø–ª–æ—â–∞–¥–∏ –¥–æ–º–∞</div></div></div>
        </div>

        <div class="field">
          <label>–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ —Ñ–∏–∫—Å-–æ–ø—Ü–∏–∏</label>
          <div class="checks">
            <div class="check"><input id="ventBase" type="checkbox"><div><div class="ct">–í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –±–∞–∑–∞: 3 –≥—Ä–∏–±–∫–∞ + 4 –∫–ª–∞–ø–∞–Ω–∞</div><div class="cs">–§–∏–∫—Å. –æ–ø—Ü–∏—è</div></div></div>
            <div class="check"><input id="cleanElectric" type="checkbox"><div><div class="ct">–ß–∏—Å—Ç–æ–≤–∞—è —ç–ª–µ–∫—Ç—Ä–∏–∫–∞ (—Ä–æ–∑–µ—Ç–∫–∏/—Å–≤–µ—Ç/–≤—ã–∫–ª—é—á–∞—Ç–µ–ª–∏)</div><div class="cs">–§–∏–∫—Å. –æ–ø—Ü–∏—è</div></div></div>
            <div class="check"><input id="plumbing" type="checkbox"><div><div class="ct">–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞ (—É–Ω–∏—Ç–∞–∑—ã/—Ä–∞–∫–æ–≤–∏–Ω—ã/–≤–∞–Ω–Ω—ã/–∫–∞–±–∏–Ω—ã/—Å–º–µ—Å–∏—Ç–µ–ª–∏/–¥—É—à)</div><div class="cs">–§–∏–∫—Å. –æ–ø—Ü–∏—è</div></div></div>
            <div class="check"><input id="boilerRoom" type="checkbox"><div><div class="ct">–ö–æ—Ç–µ–ª—å–Ω–∞—è + –∫–æ—Å–≤–µ–Ω–Ω—ã–π –±–æ–π–ª–µ—Ä</div><div class="cs">–§–∏–∫—Å. –æ–ø—Ü–∏—è</div></div></div>
          </div>
        </div>

        <div class="field">
          <label>–°–∫–≤–∞–∂–∏–Ω–∞ / —Å–µ–ø—Ç–∏–∫</label>
          <div class="checks">
            <div class="check"><input id="septic" type="checkbox"><div><div class="ct">–°–µ–ø—Ç–∏–∫ ¬´–ö–∏–±–µ–∑-5¬ª –ø–æ–¥ –∫–ª—é—á</div><div class="cs">–§–∏–∫—Å. –æ–ø—Ü–∏—è</div></div></div>
            <div class="check"><input id="well" type="checkbox"><div><div class="ct">–°–∫–≤–∞–∂–∏–Ω–∞ (40 –º —Å –∫–µ—Å—Å–æ–Ω–æ–º) –ø–æ–¥ –∫–ª—é—á</div><div class="cs">–§–∏–∫—Å. –æ–ø—Ü–∏—è (—Å –¥–æ–ø–ª–∞—Ç–æ–π –∑–∞ –≥–ª—É–±–∏–Ω—É)</div></div></div>
          </div>
          <div class="field row2">
            <div><label for="wellDepth">–ì–ª—É–±–∏–Ω–∞ —Å–∫–≤–∞–∂–∏–Ω—ã, –º</label><input id="wellDepth" type="number" min="0" value="40"></div>
            <div><label>&nbsp;</label><button class="btn ghost mini" onclick="recalc()">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å</button><div class="hint">–°—á–∏—Ç–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div></div>
          </div>
        </div>
      </div>

      <!-- STEP 5 -->
      <div class="step" data-step="5">
        <div class="kicker">–®–∞–≥ 5</div>
        <div class="stitle">–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞ (–ø–æ –º¬≤)</div>
        <div class="hint">–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ ‚Äî —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ –ø–ª–æ—â–∞–¥—å –¥–æ–º–∞.</div>
        <div class="checks" id="finishList"></div>

        <div class="sep"></div>
        <div class="badge">üéÅ –ü–æ–¥–∞—Ä–æ–∫: —Å–∫–∏–¥–∫–∞ 2% ‚Äú–æ—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è‚Äù –ø—Ä–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–º —Ä–∞—Å—á—ë—Ç–µ</div>
        <div class="hint" style="margin-top:10px;">–û—Ç–∫—Ä–æ–π—Ç–µ ¬´–†–∞—Å—á—ë—Ç –¥–ª—è –ø–µ—á–∞—Ç–∏¬ª: –ö–ü + –ø–µ—Ä–µ—á–µ–Ω—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç.</div>
      </div>

      <div class="nav">
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn ghost" id="prev" onclick="prevStep()" disabled>‚Üê –ù–∞–∑–∞–¥</button>
          <button class="btn ghost" onclick="resetAll()">–°–±—Ä–æ—Å–∏—Ç—å —Ä–∞—Å—á—ë—Ç</button>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn ghost" onclick="openPrint()">–†–∞—Å—á—ë—Ç –¥–ª—è –ø–µ—á–∞—Ç–∏</button>
          <button class="btn primary" id="next" onclick="nextStep()">–î–∞–ª–µ–µ</button>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="card">
      <div class="rhead">
        <div>
          <div class="rbrand">–≠–∫–æ –ö–∞—Ä–∫–∞—Å</div>
          <div class="sub">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç (–æ–Ω–ª–∞–π–Ω)</div>
        </div>
      </div>

      <div class="total" id="total">‚Äî</div>
      <div class="perm2" id="perm2">‚Äî</div>

      <div class="sep"></div>
      <div class="line"><span>–ë–∞–∑–∞ –¥–æ–º–∞</span><b id="baseLine">‚Äî</b></div>
      <div class="line"><span>–§—É–Ω–¥–∞–º–µ–Ω—Ç</span><b id="foundLine">‚Äî</b></div>
      <div class="line"><span>–§–∞—Å–∞–¥</span><b id="extLine">‚Äî</b></div>
      <div class="line"><span>–¢–µ—Ä—Ä–∞—Å—ã</span><b id="terrLine">‚Äî</b></div>
      <div class="line"><span>–û–∫–Ω–∞ –∏ –æ–ø—Ü–∏–∏</span><b id="winLine">‚Äî</b></div>
      <div class="line"><span>–ö—Ä–æ–≤–ª—è –∏ –¥–æ–±–æ—Ä—ã</span><b id="roofLine">‚Äî</b></div>
      <div class="line"><span>–ò–Ω–∂–µ–Ω–µ—Ä–∏—è</span><b id="engLine">‚Äî</b></div>
      <div class="line"><span>–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞</span><b id="finLine">‚Äî</b></div>

      <div class="sep"></div>
      <div class="line"><span>–°–∫–∏–¥–∫–∞ 2%</span><b id="discLine">‚Äî</b></div>
      <div class="line" style="font-size:14px;"><span>–ò—Ç–æ–≥–æ —Å–æ —Å–∫–∏–¥–∫–æ–π</span><b id="finalLine">‚Äî</b></div>

      <div class="sep"></div>
      <div class="pills" id="pills"></div>

      <div class="sep"></div>
      <div class="footer-note">*–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ä–∞—Å—á—ë—Ç. –¢–æ—á–Ω—É—é —Å–º–µ—Ç—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ø–æ—Å–ª–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏, –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–æ—Å—Ç–∞–≤–∞ —Ä–∞–±–æ—Ç.</div>
    </div>
  </div>
</div>

<script>
  // ====== PRICES (hidden from UI, used in calc) ======
  const BASE_PRICE_PER_M2 = { frame:62000, gasblock:68000, porotherm:85000 };

  // terraces
  const TERRACE_CLOSED_PER_M2 = 25000;
  const TERRACE_OPEN_PER_M2   = 14000;

  // facade add-ons (per m2 of HOUSE area)
  const EXTERIOR_ADD = { wood:0, planken:6500, metal:6500, hauberk:5500 };
  const PAINT_WOOD_PER_M2 = 1500;

  // stone-only facade option
  const FACE_BRICK_ADD_PER_M2 = 11000;

  // windows
  const WINDOWS_LAMINATED_ADD_PER_M2 = 5000;
  const OPT_PORTAL=100000, OPT_MOSQUITO=26000, OPT_ENERGY=54000;

  // roof
  const ROOF_AREA_COEF = {1:1.25,2:1.25};
  const ROOF_TYPE_COEF = { metal_tile:1.00, prof:0.95, click:1.10, soft:1.12 };
  const DRAIN_METAL_PER_M2_ROOF=8000, DRAIN_PLASTIC_PER_M2_ROOF=4500, SNOW_PER_M2_ROOF=3500;
  const SOFFIT_METAL_PER_M2 = 500; // by HOUSE area

  // engineering (+25% stays in calculation but hidden in UI)
  const ENGINEERING_MARKUP=1.25;
  const VENT_BASE_FIXED=190000, CLEAN_ELECTRIC_FIXED=180000, PLUMBING_FIXED=310000;
  const BOILER_ROOM_FIXED=260000;
  const SEPTIC_FIXED=230000, WELL_BASE_40_FIXED=350000, WELL_EXTRA_PER_M=3000;

  // base engineering per m2 (hidden)
  const P_HEAT=5500, P_WATER=3500, P_ELECTRIC=4500, P_VENT=0;

  // foundation (frame only)
  const FOUNDATION_RC_PILES_FIXED=150000;
  const FOUNDATION_SLAB300_PER_M2=24000;

  // interior finish
  const FINISH_ITEMS = [
    { id:"fin1", title:"–û—Ç–¥–µ–ª–∫–∞ —Å—Ç–µ–Ω –ì–ö–õ –±–µ–∑ —à–ø–∞–∫–ª–µ–≤–∫–∏ –∏ –æ–∫—Ä–∞—Å–∞", per_m2:2500 },
    { id:"fin2", title:"–û—Ç–¥–µ–ª–∫–∞ —Å—Ç–µ–Ω –ì–ö–õ —Å–æ —Å—Ç–µ–∫–ª–æ—Ö–æ–ª—Å—Ç–æ–º, —à–ø–∞–∫–ª–µ–≤–∫–æ–π –∏ –æ–∫—Ä–∞—Å–æ–º", per_m2:12000 },
    { id:"fin3", title:"–û—Ç–¥–µ–ª–∫–∞ —Å—Ç–µ–Ω –õ–ì–ö–õ –ª–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π", per_m2:5500 },
    { id:"fin4", title:"–û—Ç–¥–µ–ª–∫–∞ —Å—Ç–µ–Ω –∫—Ä–∞—à–µ–Ω–æ–π –Ω–∞ –∑–∞–≤–æ–¥–µ –∏–º–∏—Ç–∞—Ü–∏–µ–π –±—Ä—É—Å–∞", per_m2:9500 },
    { id:"fin5", title:"–ö–µ—Ä–∞–º–æ–≥—Ä–∞–Ω–∏—Ç —Å–∞–Ω—É–∑–µ–ª / –≤–∞–Ω–Ω–∞", per_m2:3500 },
    { id:"fin6", title:"–û—Ç–∫–æ—Å—ã –æ–∫–æ–Ω–Ω—ã–µ", per_m2:1000 },
    { id:"fin8", title:"–£–∫–ª–∞–¥–∫–∞ –∫–≤–∞—Ä—Ü-–≤–∏–Ω–∏–ª–∞ —Å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º", per_m2:3900 },
    { id:"fin9", title:"–ú–æ–Ω—Ç–∞–∂ –ø–ª–∏–Ω—Ç—É—Å–∞ —Å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º", per_m2:500 },
    { id:"fin10", title:"–ú–æ–Ω—Ç–∞–∂ –¥–≤–µ—Ä–Ω—ã—Ö –ø–æ–ª–æ—Ç–µ–Ω —Å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º", per_m2:2500 },
    { id:"fin11", title:"–ù–∞—Ç—è–∂–Ω—ã–µ –ø–æ—Ç–æ–ª–∫–∏ –±–µ–ª—ã–µ –º–∞—Ç–æ–≤—ã–µ", per_m2:3000 },
  ];

  // ====== STATE ======
  const state = {
    houseType:"frame", floors:1, insulation:"200",
    area:100, terraceClosed:0, terraceOpen:0, terraceCover:"dpk",
    foundation:"screw",
    exterior:"wood", paintWood:false, faceBrick:false,
    windows:"white",
    roof:"metal_tile", drainMetal:false, drainPlastic:false, snow:false, soffitMetal:false,
    portal:false, mosquito:false, energyGlass:false,
    engHeat:false, engWater:false, engElectric:false, engVent:false,
    ventBase:false, cleanElectric:false, plumbing:false, boilerRoom:false,
    septic:false, well:false, wellDepth:40,
    finish:{}
  };

  let step=1; const stepsTotal=5;

  // build finish list
  const finishList = document.getElementById("finishList");
  FINISH_ITEMS.forEach(it=>{
    const row=document.createElement("div");
    row.className="check";
    row.innerHTML = `<input type="checkbox" id="${it.id}"><div><div class="ct">${it.title}</div><div class="cs">–£—á–∏—Ç—ã–≤–∞–µ–º –ø–æ –ø–ª–æ—â–∞–¥–∏</div></div>`;
    finishList.appendChild(row);
    state.finish[it.id]=false;
  });

  // ====== HELPERS ======
  function money(x){return Math.round(x).toLocaleString("ru-RU")+" ‚ÇΩ";}
  function clampNum(v,min,max){ if(isNaN(v)) return min; return Math.max(min,Math.min(max,v)); }

  function getRoofArea(){
    const base = state.area / state.floors;
    const coef = ROOF_AREA_COEF[state.floors] ?? 1.25;
    const typeCoef = ROOF_TYPE_COEF[state.roof] ?? 1;
    return base * coef * typeCoef;
  }

  function readInputs(){
    state.area = parseFloat((document.getElementById("area").value||"").replace(",", "."));
    state.terraceClosed = parseFloat((document.getElementById("terraceClosed").value||"0").replace(",", "."));
    state.terraceOpen   = parseFloat((document.getElementById("terraceOpen").value||"0").replace(",", "."));
    state.terraceCover  = document.getElementById("terraceCover").value;

    state.paintWood = document.getElementById("paintWood").checked;
    state.faceBrick = document.getElementById("faceBrick").checked;

    state.portal = document.getElementById("portal").checked;
    state.mosquito = document.getElementById("mosquito").checked;
    state.energyGlass = document.getElementById("energyGlass").checked;

    state.drainMetal = document.getElementById("drainMetal").checked;
    state.drainPlastic = document.getElementById("drainPlastic").checked;
    state.snow = document.getElementById("snow").checked;
    state.soffitMetal = document.getElementById("soffitMetal").checked;

    state.engHeat = document.getElementById("engHeat").checked;
    state.engWater = document.getElementById("engWater").checked;
    state.engElectric = document.getElementById("engElectric").checked;
    state.engVent = document.getElementById("engVent").checked;

    state.ventBase = document.getElementById("ventBase").checked;
    state.cleanElectric = document.getElementById("cleanElectric").checked;
    state.plumbing = document.getElementById("plumbing").checked;
    state.boilerRoom = document.getElementById("boilerRoom").checked;

    state.septic = document.getElementById("septic").checked;
    state.well = document.getElementById("well").checked;
    state.wellDepth = parseFloat((document.getElementById("wellDepth").value||"0").replace(",", "."));

    FINISH_ITEMS.forEach(it => state.finish[it.id] = document.getElementById(it.id).checked);
  }

  function validateArea(){
    const err=document.getElementById("areaErr");
    if(isNaN(state.area)||state.area<40||state.area>500){ err.style.display="block"; return false; }
    err.style.display="none"; return true;
  }

  function applyHouseTypeRules(){
    const isFrame = state.houseType === "frame";

    document.getElementById("insulationWrap").style.display = isFrame ? "" : "none";

    document.getElementById("foundationFrameWrap").style.display = isFrame ? "" : "none";
    document.getElementById("foundationStoneHint").style.display = isFrame ? "none" : "";
    if(!isFrame){
      state.foundation = "slab250";
      document.querySelectorAll("[data-group='foundation'] .opt").forEach(x=>x.classList.remove("active"));
    } else {
      if(state.foundation==="slab250") state.foundation="screw";
      const cur = document.querySelector(`[data-group='foundation'] .opt[data-value='${state.foundation}']`);
      if(cur){
        document.querySelectorAll("[data-group='foundation'] .opt").forEach(x=>x.classList.remove("active"));
        cur.classList.add("active");
      }
    }

    document.getElementById("faceBrickWrap").style.display = isFrame ? "none" : "";
    if(isFrame) document.getElementById("faceBrick").checked = false;

    const canPaint = isFrame && state.exterior==="wood";
    document.getElementById("paintWrap").style.display = canPaint ? "" : "none";
    if(!canPaint) document.getElementById("paintWood").checked = false;

    const header = document.getElementById("foundationHeader");
    header.textContent = isFrame
      ? "–§—É–Ω–¥–∞–º–µ–Ω—Ç: –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è (—Å–≤–∞–∏/–ñ–ë–ò/–ø–ª–∏—Ç–∞ 300) ¬∑ –î–ª—è –∫–∞–º–µ–Ω–Ω—ã—Ö –¥–æ–º–æ–≤ ‚Äî –ø–ª–∏—Ç–∞ 250 –º–º –≤ –±–∞–∑–µ"
      : "–§—É–Ω–¥–∞–º–µ–Ω—Ç: –º–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –ø–ª–∏—Ç–∞ 250 –º–º (–≤ –±–∞–∑–µ, –±–µ–∑ –¥–æ–ø–ª–∞—Ç)";
  }

  function updatePills(roofArea){
    const typeMap={frame:"–ö–∞—Ä–∫–∞—Å–Ω—ã–π",gasblock:"–ì–∞–∑–æ–±–ª–æ–∫ 400 –º–º",porotherm:"Porotherm/–∫–∏—Ä–ø–∏—á 440 –º–º"};
    const mapExt={wood:"–§–∞—Å–∞–¥: –¥–µ—Ä–µ–≤–æ (–∏–º–∏—Ç–∞—Ü–∏—è –±—Ä—É—Å–∞)",planken:"–§–∞—Å–∞–¥: –ø–ª–∞–Ω–∫–µ–Ω",metal:"–§–∞—Å–∞–¥: –º–µ—Ç–∞–ª–ª–æ—Å–∞–π–¥–∏–Ω–≥",hauberk:"–§–∞—Å–∞–¥: Hauberk"};
    const mapRoof={metal_tile:"–ö—Ä–æ–≤–ª—è: –º–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞",prof:"–ö—Ä–æ–≤–ª—è: –ø—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª",click:"–ö—Ä–æ–≤–ª—è: –∫–ª–∏–∫-—Ñ–∞–ª—å—Ü",soft:"–ö—Ä–æ–≤–ª—è: –º—è–≥–∫–∞—è"};
    const mapWin={white:"–û–∫–Ω–∞: –±–µ–ª—ã–µ",laminated:"–û–∫–Ω–∞: –ª–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ"};

    const pills=[];
    pills.push(typeMap[state.houseType]||"–î–æ–º");
    pills.push(state.floors===1?"1 —ç—Ç–∞–∂":"2 —ç—Ç–∞–∂–∞");
    if(state.houseType==="frame") pills.push("–£—Ç–µ–ø–ª–µ–Ω–∏–µ "+state.insulation+" –º–º");
    if(state.houseType==="frame"){
      const fMap={screw:"–§—É–Ω–¥–∞–º–µ–Ω—Ç: –≤–∏–Ω—Ç–æ–≤—ã–µ —Å–≤–∞–∏",rcpiles:"–§—É–Ω–¥–∞–º–µ–Ω—Ç: –ñ–ë–ò —Å–≤–∞–∏",slab300:"–§—É–Ω–¥–∞–º–µ–Ω—Ç: –ø–ª–∏—Ç–∞ 300 –º–º"};
      pills.push(fMap[state.foundation]||"–§—É–Ω–¥–∞–º–µ–Ω—Ç: –≤–∏–Ω—Ç–æ–≤—ã–µ —Å–≤–∞–∏");
    } else {
      pills.push("–§—É–Ω–¥–∞–º–µ–Ω—Ç: –ø–ª–∏—Ç–∞ 250 –º–º (–≤ –±–∞–∑–µ)");
    }
    pills.push(mapExt[state.exterior]||"");
    if(document.getElementById("paintWood").checked) pills.push("–û–∫—Ä–∞—Å–∫–∞ —Ñ–∞—Å–∞–¥–∞");
    if(state.houseType!=="frame" && document.getElementById("faceBrick").checked) pills.push("–û–±–ª–∏—Ü–æ–≤–æ—á–Ω—ã–π –∫–∏—Ä–ø–∏—á");
    pills.push(mapWin[state.windows]||"");
    pills.push(mapRoof[state.roof]||"");
    pills.push(state.area+" –º¬≤");
    if(state.terraceClosed>0) pills.push("–¢–µ—Ä—Ä–∞—Å–∞ –∑–∞–∫—Ä—ã—Ç–∞—è: "+state.terraceClosed+" –º¬≤");
    if(state.terraceOpen>0) pills.push("–¢–µ—Ä—Ä–∞—Å–∞ –æ—Ç–∫—Ä—ã—Ç–∞—è: "+state.terraceOpen+" –º¬≤");
    pills.push("–ö—Ä–æ–≤–ª—è ~ "+Math.round(roofArea)+" –º¬≤");

    const wrap=document.getElementById("pills");
    wrap.innerHTML="";
    pills.filter(Boolean).forEach((t,i)=>{
      const el=document.createElement("span");
      el.className="pill"+(i<3?" green":"");
      el.textContent=t;
      wrap.appendChild(el);
    });
  }

  // ====== CALC ======
  function calc(){
    readInputs();
    if(!validateArea()) state.area = clampNum(state.area,40,500);

    const area = state.area;

    const basePerM2 = BASE_PRICE_PER_M2[state.houseType] ?? BASE_PRICE_PER_M2.frame;
    const base = area * basePerM2;

    let foundation = 0;
    if(state.houseType === "frame"){
      if(state.foundation === "rcpiles") foundation = FOUNDATION_RC_PILES_FIXED;
      if(state.foundation === "slab300") foundation = area * FOUNDATION_SLAB300_PER_M2;
    }

    let ext = (EXTERIOR_ADD[state.exterior] ?? 0) * area;
    if(state.houseType !== "frame" && document.getElementById("faceBrick").checked){
      ext += FACE_BRICK_ADD_PER_M2 * area;
    }
    if(state.houseType==="frame" && state.exterior==="wood" && document.getElementById("paintWood").checked){
      ext += area * PAINT_WOOD_PER_M2;
    }

    const terrace = (state.terraceClosed * TERRACE_CLOSED_PER_M2) + (state.terraceOpen * TERRACE_OPEN_PER_M2);

    const winLam = (state.windows==="laminated") ? (area * WINDOWS_LAMINATED_ADD_PER_M2) : 0;
    const winOpts = (state.portal?OPT_PORTAL:0) + (state.mosquito?OPT_MOSQUITO:0) + (state.energyGlass?OPT_ENERGY:0);
    const windows = winLam + winOpts;

    const roofArea = getRoofArea();
    let roofExtras =
      (state.drainMetal ? roofArea * DRAIN_METAL_PER_M2_ROOF : 0) +
      (state.drainPlastic ? roofArea * DRAIN_PLASTIC_PER_M2_ROOF : 0) +
      (state.snow ? roofArea * SNOW_PER_M2_ROOF : 0);
    if(state.soffitMetal) roofExtras += area * SOFFIT_METAL_PER_M2;

    // engineering (per-m2 prices hidden)
    let eng = 0;
    if(state.engHeat) eng += area * P_HEAT;
    if(state.engWater) eng += area * P_WATER;
    if(state.engElectric) eng += area * P_ELECTRIC;
    if(state.engVent) eng += area * P_VENT;

    let engFixed = 0;
    if(state.ventBase) engFixed += VENT_BASE_FIXED;
    if(state.cleanElectric) engFixed += CLEAN_ELECTRIC_FIXED;
    if(state.plumbing) engFixed += PLUMBING_FIXED;
    if(state.boilerRoom) engFixed += BOILER_ROOM_FIXED;
    if(state.septic) engFixed += SEPTIC_FIXED;
    if(state.well){
      const depth = Math.max(0, state.wellDepth || 0);
      const extra = Math.max(0, depth - 40) * WELL_EXTRA_PER_M;
      engFixed += WELL_BASE_40_FIXED + extra;
    }
    eng = (eng + engFixed) * ENGINEERING_MARKUP;

    let fin = 0;
    FINISH_ITEMS.forEach(it=>{
      if(state.finish[it.id]) fin += area * it.per_m2;
    });

    const subtotal = base + foundation + ext + terrace + windows + roofExtras + eng + fin;
    const discount = subtotal * 0.02;
    const total = subtotal - discount;
    const perM2 = total / area;

    document.getElementById("total").textContent = money(total);
    document.getElementById("perm2").textContent = money(perM2) + " / –º¬≤ (–ø–æ –∂–∏–ª–æ–π –ø–ª–æ—â–∞–¥–∏)";

    document.getElementById("baseLine").textContent = money(base);
    document.getElementById("foundLine").textContent = money(foundation);
    document.getElementById("extLine").textContent = money(ext);
    document.getElementById("terrLine").textContent = money(terrace);
    document.getElementById("winLine").textContent = money(windows);
    document.getElementById("roofLine").textContent = money(roofExtras);
    document.getElementById("engLine").textContent = money(eng);
    document.getElementById("finLine").textContent = money(fin);

    document.getElementById("discLine").textContent = "‚àí " + money(discount);
    document.getElementById("finalLine").textContent = money(total);

    updatePills(roofArea);
  }

  // ====== STEPS ======
  function showStep(n){
    step=n;
    document.querySelectorAll(".step").forEach(s=>s.classList.toggle("active",Number(s.dataset.step)===n));
    document.getElementById("prev").disabled = (n===1);
    document.getElementById("next").textContent = (n===stepsTotal) ? "–ì–æ—Ç–æ–≤–æ" : "–î–∞–ª–µ–µ";
    document.getElementById("fill").style.width = (n/stepsTotal*100)+"%";
    document.getElementById("ptext").textContent = `–®–∞–≥ ${n} –∏–∑ ${stepsTotal}`;
  }
  function nextStep(){ if(step===2||step===5){readInputs();validateArea();} showStep(Math.min(stepsTotal,step+1)); applyHouseTypeRules(); calc(); }
  function prevStep(){ showStep(Math.max(1,step-1)); applyHouseTypeRules(); calc(); }
  function recalc(){ applyHouseTypeRules(); calc(); }

  // ====== RESET ======
  function resetAll(){
    state.houseType="frame"; state.floors=1; state.insulation="200";
    state.area=100; state.terraceClosed=0; state.terraceOpen=0; state.terraceCover="dpk";
    state.foundation="screw";
    state.exterior="wood"; state.paintWood=false; state.faceBrick=false;
    state.windows="white"; state.roof="metal_tile";
    state.drainMetal=false; state.drainPlastic=false; state.snow=false; state.soffitMetal=false;
    state.portal=false; state.mosquito=false; state.energyGlass=false;
    state.engHeat=false; state.engWater=false; state.engElectric=false; state.engVent=false;
    state.ventBase=false; state.cleanElectric=false; state.plumbing=false; state.boilerRoom=false;
    state.septic=false; state.well=false; state.wellDepth=40;

    document.getElementById("area").value=100;
    document.getElementById("terraceClosed").value=0;
    document.getElementById("terraceOpen").value=0;
    document.getElementById("terraceCover").value="dpk";

    document.getElementById("paintWood").checked=false;
    document.getElementById("faceBrick").checked=false;

    ["portal","mosquito","energyGlass","drainMetal","drainPlastic","snow","soffitMetal",
     "engHeat","engWater","engElectric","engVent",
     "ventBase","cleanElectric","plumbing","boilerRoom","septic","well"
    ].forEach(id=>document.getElementById(id).checked=false);

    document.getElementById("wellDepth").value=40;

    FINISH_ITEMS.forEach(it=>document.getElementById(it.id).checked=false);

    document.querySelectorAll("[data-group] .opt").forEach(x=>x.classList.remove("active"));
    document.querySelector("[data-group='houseType'] .opt[data-value='frame']").classList.add("active");
    document.querySelector("[data-group='floors'] .opt[data-value='1']").classList.add("active");
    document.querySelector("[data-group='insulation'] .opt[data-value='200']").classList.add("active");
    document.querySelector("[data-group='foundation'] .opt[data-value='screw']").classList.add("active");
    document.querySelector("[data-group='exterior'] .opt[data-value='wood']").classList.add("active");
    document.querySelector("[data-group='windows'] .opt[data-value='white']").classList.add("active");
    document.querySelector("[data-group='roof'] .opt[data-value='metal_tile']").classList.add("active");

    showStep(1);
    applyHouseTypeRules();
    calc();
  }

  // ====== PRINT WINDOW (KP) ======
  function openPrint(){
    calc(); readInputs();
    const roofArea = getRoofArea();
    const typeMap={frame:"–ö–∞—Ä–∫–∞—Å–Ω—ã–π",gasblock:"–ì–∞–∑–æ–±–ª–æ–∫ 400 –º–º",porotherm:"Porotherm/–∫–∏—Ä–ø–∏—á 440 –º–º"};
    const fMap={screw:"–í–∏–Ω—Ç–æ–≤—ã–µ —Å–≤–∞–∏ 108√ó2500 (–≤ –±–∞–∑–µ)",rcpiles:"–ñ–ë–ò —Å–≤–∞–∏ 150√ó150√ó3000",slab300:"–ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –ø–ª–∏—Ç–∞ 300 –º–º"};

    const selections = [
      {k:"–¢–∏–ø –¥–æ–º–∞", v:typeMap[state.houseType]||"–î–æ–º"},
      {k:"–≠—Ç–∞–∂–Ω–æ—Å—Ç—å", v:state.floors===1?"1 —ç—Ç–∞–∂":"2 —ç—Ç–∞–∂–∞"},
      ...(state.houseType==="frame" ? [{k:"–£—Ç–µ–ø–ª–µ–Ω–∏–µ", v:state.insulation+" –º–º"}] : []),
      {k:"–ü–ª–æ—â–∞–¥—å –¥–æ–º–∞", v:state.area+" –º¬≤"},
      {k:"–¢–µ—Ä—Ä–∞—Å–∞ –∑–∞–∫—Ä—ã—Ç–∞—è", v:state.terraceClosed+" –º¬≤"},
      {k:"–¢–µ—Ä—Ä–∞—Å–∞ –æ—Ç–∫—Ä—ã—Ç–∞—è", v:state.terraceOpen+" –º¬≤"},
      {k:"–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Ä—Ä–∞—Å—ã", v:(state.terraceCover==="dpk"?"–î–ü–ö":"–õ–∏—Å—Ç–≤–µ–Ω–Ω–∏—Ü–∞")},
      {k:"–§—É–Ω–¥–∞–º–µ–Ω—Ç", v:(state.houseType==="frame" ? (fMap[state.foundation]||fMap.screw) : "–ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –ø–ª–∏—Ç–∞ 250 –º–º (–≤ –±–∞–∑–µ)")},
      {k:"–ü–ª–æ—â–∞–¥—å –∫—Ä–æ–≤–ª–∏ (–æ—Ü–µ–Ω–∫–∞)", v:Math.round(roofArea)+" –º¬≤"}
    ];

    const extras=[];
    const pushIf=(id,name)=>{ if(document.getElementById(id).checked) extras.push(name); };
    pushIf("paintWood","–û–∫—Ä–∞—Å–∫–∞ —Ñ–∞—Å–∞–¥–∞ (–¥–µ—Ä–µ–≤–æ)");
    if(state.houseType!=="frame") pushIf("faceBrick","–û–±–ª–∏—Ü–æ–≤–æ—á–Ω—ã–π –∫–∏—Ä–ø–∏—á");
    pushIf("portal","–†–∞–∑–¥–≤–∏–∂–Ω–æ–π –ø–æ—Ä—Ç–∞–ª");
    pushIf("mosquito","–ú–æ—Å–∫–∏—Ç–Ω—ã–µ —Å–µ—Ç–∫–∏");
    pushIf("energyGlass","–≠–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–≥–∞—é—â–∏–µ —Å—Ç–µ–∫–ª–∞");
    pushIf("drainMetal","–í–æ–¥–æ—Å—Ç–æ–∫ Grand Line (–º–µ—Ç–∞–ª–ª)");
    pushIf("drainPlastic","–í–æ–¥–æ—Å—Ç–æ–∫ (–ø–ª–∞—Å—Ç–∏–∫)");
    pushIf("snow","–°–Ω–µ–≥–æ–∑–∞–¥–µ—Ä–∂–∞—Ç–µ–ª–∏");
    pushIf("soffitMetal","–ü–æ–¥—à–∏–≤ —Å–≤–µ—Å–æ–≤: –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π —Å–æ—Ñ–∏—Ç");
    pushIf("ventBase","–í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –±–∞–∑–∞ (3 –≥—Ä–∏–±–∫–∞ + 4 –∫–ª–∞–ø–∞–Ω–∞)");
    pushIf("cleanElectric","–ß–∏—Å—Ç–æ–≤–∞—è —ç–ª–µ–∫—Ç—Ä–∏–∫–∞");
    pushIf("plumbing","–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞");
    pushIf("boilerRoom","–ö–æ—Ç–µ–ª—å–Ω–∞—è + –∫–æ—Å–≤–µ–Ω–Ω—ã–π –±–æ–π–ª–µ—Ä");
    pushIf("septic","–°–µ–ø—Ç–∏–∫ –ö–∏–±–µ–∑-5");
    pushIf("well","–°–∫–≤–∞–∂–∏–Ω–∞ + –∫–µ—Å—Å–æ–Ω");

    const finSel = FINISH_ITEMS.filter(it=>document.getElementById(it.id).checked).map(it=>it.title);

    const baseLine=document.getElementById("baseLine").textContent;
    const foundLine=document.getElementById("foundLine").textContent;
    const extLine=document.getElementById("extLine").textContent;
    const terrLine=document.getElementById("terrLine").textContent;
    const winLine=document.getElementById("winLine").textContent;
    const roofLine=document.getElementById("roofLine").textContent;
    const engLine=document.getElementById("engLine").textContent;
    const finLine=document.getElementById("finLine").textContent;
    const discLine=document.getElementById("discLine").textContent;
    const finalLine=document.getElementById("finalLine").textContent;

    const stamp=new Date().toLocaleString("ru-RU");
    const w=window.open("","_blank","width=980,height=720");
    w.document.write(`<!doctype html><html lang="ru"><head><meta charset="utf-8">
      <title>–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ‚Äî –≠–∫–æ –ö–∞—Ä–∫–∞—Å</title>
      <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&display=swap" rel="stylesheet">
      <style>
        body{font-family:Manrope,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:24px;color:#0f172a;}
        h2{margin:0 0 6px;font-size:22px;letter-spacing:.02em;text-transform:uppercase;font-weight:800;}
        .sub{color:#64748b;font-size:12px;margin-bottom:16px;}
        .box{border:1px solid #e6ebef;border-radius:14px;padding:14px;margin-bottom:14px;}
        table{width:100%;border-collapse:collapse;font-size:13px;}
        td{padding:8px 6px;border-bottom:1px dashed #e6ebef;vertical-align:top;}
        td:first-child{color:#334155;font-weight:800;width:56%;}
        .tot{font-size:20px;font-weight:900;}
        .green{background:#dcfce7;border:1px solid rgba(34,197,94,.35);padding:10px 12px;border-radius:12px;}
        ul{margin:8px 0 0 18px;color:#334155;}
        .btns{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;}
        button{border:none;border-radius:999px;padding:10px 14px;font-weight:900;cursor:pointer;}
        .p{background:linear-gradient(135deg,#7ed957,#39b54a);color:#fff;}
        .g{background:#f1f5f9;color:#0f172a;}
        @media print {.btns{display:none;} body{margin:0;}}
      </style></head><body>
      <h2>–≠–∫–æ –ö–∞—Ä–∫–∞—Å ‚Äî —Ä–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏</h2>
      <div class="sub">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ: ${stamp} ¬∑ –ø–æ–¥–∞—Ä–æ–∫: —Å–∫–∏–¥–∫–∞ 2% ‚Äú–æ—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è‚Äù –∑–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç</div>

      <div class="box"><b>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</b>
        <table>${selections.map(x=>`<tr><td>${x.k}</td><td>${x.v}</td></tr>`).join("")}</table>
        ${extras.length?`<div style="margin-top:10px;"><b>–û–ø—Ü–∏–∏:</b><ul>${extras.map(x=>`<li>${x}</li>`).join("")}</ul></div>`:""}
        ${finSel.length?`<div style="margin-top:10px;"><b>–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞:</b><ul>${finSel.map(x=>`<li>${x}</li>`).join("")}</ul></div>`:""}
      </div>

      <div class="box"><b>–°–º–µ—Ç–∞ (–ø–æ –ø—É–Ω–∫—Ç–∞–º)</b>
        <table>
          <tr><td>–ë–∞–∑–∞ –¥–æ–º–∞</td><td>${baseLine}</td></tr>
          <tr><td>–§—É–Ω–¥–∞–º–µ–Ω—Ç</td><td>${foundLine}</td></tr>
          <tr><td>–§–∞—Å–∞–¥</td><td>${extLine}</td></tr>
          <tr><td>–¢–µ—Ä—Ä–∞—Å—ã</td><td>${terrLine}</td></tr>
          <tr><td>–û–∫–Ω–∞ –∏ –æ–ø—Ü–∏–∏</td><td>${winLine}</td></tr>
          <tr><td>–ö—Ä–æ–≤–ª—è –∏ –¥–æ–±–æ—Ä—ã</td><td>${roofLine}</td></tr>
          <tr><td>–ò–Ω–∂–µ–Ω–µ—Ä–∏—è</td><td>${engLine}</td></tr>
          <tr><td>–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞</td><td>${finLine}</td></tr>
          <tr><td>–°–∫–∏–¥–∫–∞ 2%</td><td>${discLine}</td></tr>
          <tr><td class="tot">–ò—Ç–æ–≥–æ —Å–æ —Å–∫–∏–¥–∫–æ–π</td><td class="tot">${finalLine}</td></tr>
        </table>
      </div>

      <div class="green"><b>–ü–æ–¥–∞—Ä–æ–∫:</b> —Å–∫–∏–¥–∫–∞ 2% –ø—Ä–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–º —Ä–∞—Å—á—ë—Ç–µ –Ω–∞ —Å–∞–π—Ç–µ.<br><span style="color:#166534;font-weight:800;">–î–ª—è —Ç–æ—á–Ω–æ–π —Å–º–µ—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É –∏ —Å–æ—Å—Ç–∞–≤ —Ä–∞–±–æ—Ç.</span></div>
      <div class="btns"><button class="p" onclick="window.print()">–ü–µ—á–∞—Ç—å / PDF</button><button class="g" onclick="window.close()">–ó–∞–∫—Ä—ã—Ç—å</button></div>
    </body></html>`);
    w.document.close();
  }

  // ====== EVENTS ======
  document.addEventListener("click",(e)=>{
    const opt=e.target.closest(".opt");
    const group=opt?.closest("[data-group]")?.dataset.group;
    if(opt && group){
      opt.closest("[data-group]").querySelectorAll(".opt").forEach(x=>x.classList.remove("active"));
      opt.classList.add("active");
      const val=opt.dataset.value;

      if(group==="houseType") state.houseType=val;
      if(group==="floors") state.floors=Number(val);
      if(group==="insulation") state.insulation=val;
      if(group==="foundation") state.foundation=val;
      if(group==="exterior") state.exterior=val;
      if(group==="windows") state.windows=val;
      if(group==="roof") state.roof=val;

      applyHouseTypeRules();
      calc();
    }
  });

  document.addEventListener("input",(e)=>{
    if(["area","terraceClosed","terraceOpen","wellDepth"].includes(e.target.id)){
      applyHouseTypeRules();
      calc();
    }
  });

  document.addEventListener("change",(e)=>{
    if(e.target.matches("input[type='checkbox'], select")){
      applyHouseTypeRules();
      calc();
    }
  });

  // init
  showStep(1);
  applyHouseTypeRules();
  calc();
</script>
</body>
</html>
